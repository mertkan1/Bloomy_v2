"use strict";(()=>{var e={};e.id=723,e.ids=[723],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},4221:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>l});var i=r(9303),n=r(8716),o=r(670),a=r(7070),c=r(3114),u=r(9692);let p=new c.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2024-06-20"});async function l(e){try{let{giftData:t,plan:r,recipientEmail:s,deliveryDate:i}=await e.json();if(!t||!r||!s)return a.NextResponse.json({error:"Missing required fields"},{status:400});let n=(0,u.e)(),{data:{user:o}}=await n.auth.getUser();if(!o)return a.NextResponse.json({error:"Authentication required"},{status:401});let c={30:{price:1999,tokens:100},365:{price:4999,tokens:1e3}}[r];if(!c)return a.NextResponse.json({error:"Invalid plan selected"},{status:400});let l=await p.checkout.sessions.create({payment_method_types:["card"],line_items:[{price_data:{currency:"usd",product_data:{name:`Digital Flower Gift - ${r} Days`,description:`Beautiful digital flower with ${r} days of AI-generated messages`,images:[t.flower?.image||"https://images.unsplash.com/photo-1698849071904-090feee32e73"]},unit_amount:c.price},quantity:1}],mode:"payment",success_url:`${e.nextUrl.origin}/success?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${e.nextUrl.origin}/purchase`,metadata:{userId:o.id,plan:r,recipientEmail:s,deliveryDate:i||new Date().toISOString().split("T")[0],giftData:JSON.stringify(t)}});return a.NextResponse.json({sessionId:l.id})}catch(e){return console.error("Checkout error:",e),a.NextResponse.json({error:"Failed to create checkout session"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/payments/checkout/route",pathname:"/api/payments/checkout",filename:"route",bundlePath:"app/api/payments/checkout/route"},resolvedPagePath:"C:\\Users\\mertk\\Desktop\\BLOOMY\\bold\\Bloomy_v2\\app\\api\\payments\\checkout\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:x}=d,y="/api/payments/checkout/route";function g(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},9692:(e,t,r)=>{r.d(t,{e:()=>n});var s=r(7721),i=r(1615);function n(){let e=(0,i.cookies)();return(0,s.createServerClient)("https://hejgnhjmywsjklfnmmyp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhlamduaGpteXdzamtsZm5tbXlwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MDE4NDUsImV4cCI6MjA3MzA3Nzg0NX0.HFFGAmvXUuXOslSrAvRJRkjs84DnW53I8x68Yapg9tY",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>e.set(t,r,s))}catch{}}}})}},8238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let s=Reflect.get(e,t,r);return"function"==typeof s?s.bind(e):s}static set(e,t,r,s){return Reflect.set(e,t,r,s)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,760,702,972,114],()=>r(4221));module.exports=s})();