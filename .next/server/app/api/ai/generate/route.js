"use strict";(()=>{var e={};e.id=505,e.ids=[505],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},5929:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var o={};r.r(o),r.d(o,{POST:()=>l});var s=r(9303),n=r(8716),a=r(670),i=r(7070),u=r(9692);async function l(e){try{let{orderId:t,dayIndex:r,regenerate:o=!1}=await e.json(),s=(0,u.e)(),{data:{user:n}}=await s.auth.getUser();if(!n)return i.NextResponse.json({error:"Authentication required"},{status:401});let{data:a,error:l}=await s.from("orders").select("*").eq("id",t).eq("user_id",n.id).single();if(l||!a)return i.NextResponse.json({error:"Order not found"},{status:404});if(o&&a.tokens_remaining<=0)return i.NextResponse.json({error:"No tokens remaining"},{status:400});let d=a.themes||[],p=a.recipient_name,c=a.sender_name,m={romantik:[`My dearest ${p}, with each passing day, my heart grows fonder of you. This flower blooms as my love does - endlessly and beautifully.`,`Beloved ${p}, you are the sunshine that makes my world brighter. Every moment with you is a treasure I hold close to my heart.`],motivasyon:[`Dear ${p}, remember that every challenge you face is just another opportunity to show your incredible strength. You've got this!`,`Champion ${p}, your potential is limitless. Today is another chance to move closer to your dreams.`],espirili:[`Hey ${p}! Life's too short for boring flowers, so here's a digital one that won't need watering (you're welcome!)`,`${p}, if flowers had personalities, this one would definitely be the class clown. Just like you!`],default:[`Dear ${p}, I hope this message finds you well. I wanted to send you a little something to brighten your day.`,`Hello beautiful ${p}! Another day, another reason to smile. Remember that you bring so much joy to those around you.`]},h=m[d.length>0?d[0]:"default"]||m.default,g=h[r%h.length],y=`${g}

With love,
${c}`,{error:f}=await s.from("daily_messages").upsert({order_id:t,day_index:r,content:y,generated_by:"ai",generated_at:new Date().toISOString()});if(f)return console.error("Message save error:",f),i.NextResponse.json({error:"Failed to save message"},{status:500});if(o){let{error:e}=await s.from("orders").update({tokens_remaining:a.tokens_remaining-1}).eq("id",t);e&&console.error("Token deduction error:",e),await s.from("ai_events").insert({order_id:t,event_type:"regenerate",day_index:r,tokens_used:1})}return i.NextResponse.json({message:y,tokensRemaining:o?a.tokens_remaining-1:a.tokens_remaining})}catch(e){return console.error("AI generation error:",e),i.NextResponse.json({error:"Failed to generate message"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/ai/generate/route",pathname:"/api/ai/generate",filename:"route",bundlePath:"app/api/ai/generate/route"},resolvedPagePath:"C:\\Users\\mertk\\Desktop\\BLOOMY\\bold\\Bloomy_v2\\app\\api\\ai\\generate\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:m}=d,h="/api/ai/generate/route";function g(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},9692:(e,t,r)=>{r.d(t,{e:()=>n});var o=r(7721),s=r(1615);function n(){let e=(0,s.cookies)();return(0,o.createServerClient)("https://hejgnhjmywsjklfnmmyp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhlamduaGpteXdzamtsZm5tbXlwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MDE4NDUsImV4cCI6MjA3MzA3Nzg0NX0.HFFGAmvXUuXOslSrAvRJRkjs84DnW53I8x68Yapg9tY",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:o})=>e.set(t,r,o))}catch{}}}})}},8238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let o=Reflect.get(e,t,r);return"function"==typeof o?o.bind(e):o}static set(e,t,r,o){return Reflect.set(e,t,r,o)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,760,702,972],()=>r(5929));module.exports=o})();